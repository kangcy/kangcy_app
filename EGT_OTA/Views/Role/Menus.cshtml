@{
    ViewBag.Title = "Menus";
}

<h2>Menus</h2>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <title>ZTREE DEMO </title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="../../Scripts/zTree/zTreeStyle/zTreeStyle.css" type="text/css">
    <style>
        body
        {
            background-color: white;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        div, p, table, th, td
        {
            list-style: none;
            margin: 0;
            padding: 0;
            color: #333;
            font-size: 12px;
            font-family: dotum, Verdana, Arial, Helvetica, AppleGothic, sans-serif;
        }

        #testIframe
        {
            margin-left: 10px;
        }
    </style>
    <script type="text/javascript" src="../../Scripts/jquery-1.4.4.min.js"></script>
    <script type="text/javascript" src="../../Scripts/zTree/jquery.ztree.core.js"></script>
    <script type="text/javascript" src="../../Scripts/zTree/jquery.ztree.exedit.js"></script>
    <script type="text/javascript" src="../../Scripts/zTree/jquery.ztree.excheck.js"></script>
    <script type="text/javascript" src="../../Scripts/json2.js"></script>
    <script type="text/javascript">
  <!--
    var setting = {
        view: {
            selectedMulti: false
        },
        edit: {
            enable: true,
            showRemoveBtn: false,
            showRenameBtn: false
        },
        data: {
            keep: {
                parent: false,
                leaf: true
            },
            simpleData: {
                enable: true
            }
        },
        callback: {
            beforeDrag: beforeDrag,
            beforeRemove: beforeRemove,
            beforeRename: beforeRename,
            onRemove: onRemove
        }
    };
    var log, className = "dark";
    function beforeDrag(treeId, treeNodes) {
        return false;
    }
    function beforeRemove(treeId, treeNode) {
        className = (className === "dark" ? "" : "dark");
        showLog("[ " + getTime() + " beforeRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
        return confirm("确认删除 节点 -- " + treeNode.name + " 吗？");
    }
    function onRemove(e, treeId, treeNode) {
        showLog("[ " + getTime() + " onRemove ]&nbsp;&nbsp;&nbsp;&nbsp; " + treeNode.name);
    }
    function beforeRename(treeId, treeNode, newName) {
        if (newName.length == 0) {
            alert("节点名称不能为空.");
            var zTree = $.fn.zTree.getZTreeObj("treeDemo");
            setTimeout(function () { zTree.editName(treeNode) }, 10);
            return false;
        }
        return true;
    }
    function showLog(str) {
        if (!log) log = $("#log");
        log.append("<li class='" + className + "'>" + str + "</li>");
        if (log.children("li").length > 8) {
            log.get(0).removeChild(log.children("li")[0]);
        }
    }
    function getTime() {
        var now = new Date(),
        h = now.getHours(),
        m = now.getMinutes(),
        s = now.getSeconds(),
        ms = now.getMilliseconds();
        return (h + ":" + m + ":" + s + " " + ms);
    }

    var newCount = 1;
    function add(e) {
        var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
        isParent = e.data.isParent,
        nodes = zTree.getSelectedNodes(),
        treeNode = nodes[0];
        if (treeNode) {
            treeNode = zTree.addNodes(treeNode, { id: (100 + newCount), pId: treeNode.id, isParent: isParent, name: "new node" + (newCount++) });
        } else {
            treeNode = zTree.addNodes(null, { id: (100 + newCount), pId: 0, isParent: isParent, name: "new node" + (newCount++) });
        }
        if (treeNode) {
            zTree.editName(treeNode[0]);
        } else {
            alert("叶子节点被锁定，无法增加子节点");
        }
    };
    function edit() {
        var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
        nodes = zTree.getSelectedNodes(),
        treeNode = nodes[0];
        if (nodes.length == 0) {
            alert("请先选择一个节点");
            return;
        }
        zTree.editName(treeNode);
    };
    function remove(e) {
        var zTree = $.fn.zTree.getZTreeObj("treeDemo"),
        nodes = zTree.getSelectedNodes(),
        treeNode = nodes[0];
        if (nodes.length == 0) {
            alert("请先选择一个节点");
            return;
        }
        var callbackFlag = $("#callbackTrigger").attr("checked");
        zTree.removeNode(treeNode, callbackFlag);
    };

    var zNodes = [
{ "ModuleId": "1", "ParentId": "0", "FullName": "客户管理", "Icon": "fa-user", "Location": "", Button: "" },
{ "ModuleId": "11", "ParentId": "1", "FullName": "市场管理", "Icon": "fa-list", "Location": "/User/Index", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "12", "ParentId": "1", "FullName": "市场划分", "Icon": "fa-list", "Location": "/Admin2/Sys/AdminUser.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "13", "ParentId": "1", "FullName": "客户列表", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },

{ "ModuleId": "2", "ParentId": "0", "FullName": "供应商管理", "Icon": "fa-glass", "Location": "", Button: "" },
{ "ModuleId": "21", "ParentId": "2", "FullName": "机票供应商", "Icon": "fa-fighter-jet", "Location": "/TicketSupply/Index", Button: "刷新,新增,编辑,删除,查看联系人" },
{ "ModuleId": "22", "ParentId": "2", "FullName": "签证供应商", "Icon": "fa-list", "Location": "/VisaSupply/Index", Button: "刷新,新增,编辑,删除,查看联系人" },
{ "ModuleId": "23", "ParentId": "2", "FullName": "散客供应商", "Icon": "fa-list", "Location": "/TicketSupply/Index", Button: "刷新,新增,编辑,删除,查看联系人" },
{ "ModuleId": "24", "ParentId": "2", "FullName": "酒店供应商", "Icon": "fa-bed", "Location": "/TicketSupply/Index", Button: "刷新,新增,编辑,删除,查看联系人" },
{ "ModuleId": "25", "ParentId": "2", "FullName": "车行供应商", "Icon": "fa-car", "Location": "/CarSupply/Index", Button: "刷新,新增,编辑,删除,查看联系人" },
{ "ModuleId": "26", "ParentId": "2", "FullName": "导游", "Icon": "fa-male", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "27", "ParentId": "2", "FullName": "翻译", "Icon": "fa-male", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "28", "ParentId": "2", "FullName": "景区", "Icon": "fa-list", "Location": "/Scenic/Index", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "29", "ParentId": "2", "FullName": "餐厅", "Icon": "fa-cutlery", "Location": "/Restaurant/Index", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "291", "ParentId": "2", "FullName": "购物店", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "291", "ParentId": "2", "FullName": "商务单位", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "292", "ParentId": "2", "FullName": "游轮", "Icon": "fa-anchor", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },

{ "ModuleId": "3", "ParentId": "0", "FullName": "产品管理", "Icon": "fa-list", "Location": "", Button: "" },
{ "ModuleId": "31", "ParentId": "3", "FullName": "经典旅行", "Icon": "fa-list", "Location": "/TicketSupply/Index", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "32", "ParentId": "3", "FullName": "自驾旅行", "Icon": "fa-list", "Location": "/Admin2/Sys/AdminUser.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "33", "ParentId": "3", "FullName": "火车旅行", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "34", "ParentId": "3", "FullName": "游轮旅行", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "35", "ParentId": "3", "FullName": "蜜月旅行", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "36", "ParentId": "3", "FullName": "公务旅行", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "37", "ParentId": "3", "FullName": "商务旅行", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "38", "ParentId": "3", "FullName": "会展旅行", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "39", "ParentId": "3", "FullName": "城市概况", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },

{ "ModuleId": "4", "ParentId": "0", "FullName": "订单管理", "Icon": "fa-bookmark", "Location": "", Button: "" },
{ "ModuleId": "41", "ParentId": "4", "FullName": "出游需求", "Icon": "fa-list", "Location": "/User/Index", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "42", "ParentId": "4", "FullName": "订单管理", "Icon": "fa-list", "Location": "/Admin2/Sys/AdminUser.aspx", Button: "刷新,新增,编辑,删除" },

{ "ModuleId": "5", "ParentId": "0", "FullName": "财务管理", "Icon": "fa-newspaper-o", "Location": "", Button: "" },
{ "ModuleId": "51", "ParentId": "5", "FullName": "收款确认", "Icon": "fa-list", "Location": "/User/Index", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "52", "ParentId": "5", "FullName": "付款确认", "Icon": "fa-list", "Location": "/Admin2/Sys/AdminUser.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "53", "ParentId": "5", "FullName": "发票确认", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },

{ "ModuleId": "6", "ParentId": "0", "FullName": "数据分析", "Icon": "fa-bar-chart-o", "Location": "", Button: "" },
{ "ModuleId": "61", "ParentId": "6", "FullName": "销售分析", "Icon": "fa-list", "Location": "/User/Index", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "62", "ParentId": "6", "FullName": "财务分析", "Icon": "fa-list", "Location": "/Admin2/Sys/AdminUser.aspx", Button: "刷新,新增,编辑,删除" },
{ "ModuleId": "63", "ParentId": "6", "FullName": "产品分析", "Icon": "fa-list", "Location": "/Admin2/Sys/Message.aspx", Button: "刷新,新增,编辑,删除" },

{ "ModuleId": "7", "ParentId": "0", "FullName": "系统管理", "Icon": "fa-cog", "Location": "", Button: "" },
{ "ModuleId": "71", "ParentId": "7", "FullName": "用户管理", "Icon": "fa-list", "Location": "/User/Index", Button: "刷新,新增,编辑,删除,启用,取消启用" },
{ "ModuleId": "72", "ParentId": "7", "FullName": "角色管理", "Icon": "fa-list", "Location": "/Role/Index", Button: "刷新,新增,编辑,删除,启用,取消启用" },
{ "ModuleId": "74", "ParentId": "7", "FullName": "权限管理", "Icon": "fa-list", "Location": "/Role/Jurisdiction", Button: "刷新,新增,编辑,删除,启用,取消启用" },
{ "ModuleId": "73", "ParentId": "7", "FullName": "菜单管理", "Icon": "fa-list", "Location": "/Role/Menus", Button: "刷新,新增,编辑,删除,启用,取消启用" }
    ];

    $(document).ready(function () {
        // $.ajax("/Home/Menu", "", function (data) {
        //accordionJson = eval("(" + data + ")");
        //alert(zNodes);
        //var result = zNodes.toString().replace(/ModuleId/g, "id").replace(/ParentId/g, "pId").replace(/FullName/g,"name");
        //result = JSON.parse(result);
        //alert(zNodes[0]["ModuleId"]);
        //alert(zNodes[0]["id"]);
        var result = JSON.stringify(zNodes).replace(/ModuleId/g, "id").replace(/ParentId/g, "pId").replace(/FullName/g, "name");
        $.fn.zTree.init($("#treeDemo"), setting, JSON.parse(result));
        $("#addParent").bind("click", { isParent: true }, add);
        $("#addLeaf").bind("click", { isParent: false }, add);
        $("#edit").bind("click", edit);
        $("#remove").bind("click", remove);
        $("#clearChildren").bind("click", clearChildren);
        // });


    });
    function clearChildren() {
        var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
        var nodes = treeObj.getNodes();
        alert(JSON.stringify(nodes));
        //for (var i = 0; i < nodes.length; i++) {
        //    v += nodes[i].name + ",";
        //    alert(nodes[i].id); //获取选中节点的值
        //}
    }
    //-->
    </script>
</head>

<body>
    <table border="0" height="600px" align="left">
        <tr>
            @*<TD width=260px align=left valign=top style="BORDER-RIGHT: #999999 1px dashed">
			<ul id="tree" class="ztree" style="width:260px; overflow:auto;"></ul>
		</TD>
		<TD width=770px align=left valign=top><IFRAME id="testIframe" Name="testIframe" FRAMEBORDER=0 SCROLLING=AUTO width=100%  height=600px SRC="core/standardData.html"></IFRAME></TD>*@
        </tr>
    </table>
    <div class="zTreeDemoBackground left">
        <ul id="treeDemo" class="ztree"></ul>
    </div>
    &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="callbackTrigger" checked />
    removeNode 方法是否触发 callback<br />
    &nbsp;&nbsp;&nbsp;&nbsp;[ <a id="addParent" href="#" title="增加父节点" onclick="return false;">增加父节点</a> ]
					&nbsp;&nbsp;&nbsp;&nbsp;[ <a id="addLeaf" href="#" title="增加叶子节点" onclick="return false;">增加叶子节点</a> ]
					&nbsp;&nbsp;&nbsp;&nbsp;[ <a id="edit" href="#" title="编辑名称" onclick="return false;">编辑名称</a> ]<br />
    &nbsp;&nbsp;&nbsp;&nbsp;[ <a id="remove" href="#" title="删除节点" onclick="return false;">删除节点</a> ]
					&nbsp;&nbsp;&nbsp;&nbsp;[ <a id="clearChildren" href="#" title="获取最新节点" onclick="return false;">获取最新节点</a> ]<br />
    remove log:<br />
    <ul id="log" class="log"></ul>
    </p>
</body>
</html>
